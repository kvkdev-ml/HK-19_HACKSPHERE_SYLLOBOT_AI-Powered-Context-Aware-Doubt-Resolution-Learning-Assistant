{% extends "base.html" %} {% block title %}Dashboard - Syllobot{% endblock %} {%
block content %}
<!-- Sidebar -->
<aside class="sidebar">
  <div class="logo">
    <div class="logo-icon">
      <img
        src="{{ url_for('static',filename='images/Hacknovation Logo.png') }}"
        alt="SyllobotAI"
      />
    </div>
    <div>
      <h2 style="font-size: 1.25rem; margin: 0">Syllobot</h2>
      <p class="text-xs text-muted" style="margin: 0.25rem 0 0 0">
        AI Assistant
      </p>
    </div>
  </div>
  <nav>
    <a href="{{ url_for('home') }}" class="nav-link active">
      <span class="nav-icon">üìä</span>
      <span>Dashboard</span>
    </a>
    <a href="{{ url_for('history_page') }}" class="nav-link">
      <span class="nav-icon">üïê</span>
      <span>History</span>
    </a>
    <a href="{{ url_for('logout') }}" class="nav-link">
      <span class="nav-icon">üïê</span>
      <span>Logout</span>
    </a>
  </nav>

  <div class="user-profile">
    <div class="user-avatar">{{ data.fname[0] if data.fname else 'U' }}</div>
    <div class="user-info">
      <p class="user-name">{{ data.fname or 'User' }}</p>
      <p class="user-role">Student</p>
    </div>
  </div>
</aside>
<!-- Main Content -->
<div class="main-content">
  <!-- Welcome Banner -->
  <div class="welcome-banner">
    <div class="welcome-content">
      <h2 class="welcome-title">
        Welcome back, {{ data.fname or 'Student' }}! üëã
      </h2>
      <p class="welcome-subtitle">
        Syllobot is synced with your course syllabus. Ready to learn?
      </p>
    </div>
    <div class="welcome-decoration">
      <div class="decoration-circle"></div>
      <div class="decoration-circle"></div>
    </div>
  </div>

  <!-- Upload Section -->
  <div class="card upload-card">
    <div class="card-header">
      <h3 class="card-title">
        <span class="card-icon">üì§</span>
        Upload Study Material
      </h3>
    </div>
<div class="card">

  <!-- PDF Upload -->
  <form action="/upload" method="POST" enctype="multipart/form-data" style="margin-bottom:20px;">
    <label>Upload PDF</label><br>
    <input type="file" name="file" accept=".pdf" required>
    <input type="hidden" name="upload_type" value="pdf">
    <button type="submit" class="btn btn-primary">Upload PDF</button>
  </form>

  <!-- Image Upload -->
  <form action="/upload" method="POST" enctype="multipart/form-data">
    <label>Upload Image (OCR)</label><br>
    <input type="file" name="file" accept=".png,.jpg,.jpeg" required>
    <input type="hidden" name="upload_type" value="image">
    <button type="submit" class="btn btn-primary">Upload Image</button>
  </form>
</div>

    {% if uploaded_files %}
    <div class="uploaded-files-section">
      <p class="section-label">Recently Uploaded:</p>
      <div class="uploaded-files-list">
        {% for file in uploaded_files %}
        <div class="uploaded-file-item">
          <div class="uploaded-file-icon">
            {{ 'üñºÔ∏è' if file.type == 'image' else 'üìÑ' }}
          </div>
          <div class="uploaded-file-info">
            <p class="uploaded-file-name">{{ file.name }}</p>
            <p class="uploaded-file-meta">{{ file.size }} ‚Ä¢ {{ file.date }}</p>
          </div>
          <div class="uploaded-file-status">‚úì</div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </div>

  <!-- Ask Question Section -->
  <div class="card question-card">
    <div class="card-header">
      <h3 class="card-title">
        <span class="card-icon">üí¨</span>
        Ask Syllobot
      </h3>
    </div>
    <form method="POST" action="/ask" id="questionForm">
      <div class="question-input-wrapper">
        <textarea
          name="question"
          class="question-textarea"
          placeholder="Ask me anything about your syllabus..."
          required
        ></textarea>
      </div>
      <div class="question-actions">
        <button type="submit" class="btn btn-primary btn-send">
          <span>Send</span>
          <span class="btn-arrow">‚Üí</span>
        </button>
      </div>
    </form>
  </div>
  {% if messages %}
  <div class="card chat-card">
    <div class="card-header">
      <h3 class="card-title">
        <span class="card-icon">üí°</span>
        Syllobot's Answer
      </h3>
    </div>
    <div class="chat-container">
      {% for msg in messages %}
      <div
        class="message {{ 'message-user' if msg.type == 'user' else 'message-bot' }}"
      >
        <div class="message-avatar">
          <span>{{ 'U' if msg.type == 'user' else 'S' }}</span>
        </div>
        <div class="message-bubble">
          <p class="message-text">{{ msg.content }}</p>
          <p class="message-time">{{ msg.time }}</p>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}
</div>

<style>
  /* Enhanced Styling */
  :root {
    --primary: #6366f1;
    --primary-dark: #4f46e5;
    --primary-light: #818cf8;
    --secondary: #8b5cf6;
    --success: #10b981;
    --danger: #ef4444;
    --warning: #f59e0b;
    --background: #f8fafc;
    --surface: #ffffff;
    --border: #e2e8f0;
    --text: #1e293b;
    --text-muted: #64748b;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow:
      0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg:
      0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --shadow-xl:
      0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    --radius: 12px;
    --radius-lg: 16px;
  }

  /* Sidebar Enhancements */
  .sidebar {
    background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
    border-right: 1px solid var(--border);
    box-shadow: var(--shadow);
  }

  .logo {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 1.5rem;
    border-bottom: 1px solid var(--border);
  }

  .logo-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: var(--shadow);
  }

  .logo-icon img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .nav-link {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    margin: 4px 12px;
    border-radius: var(--radius);
    color: var(--text);
    text-decoration: none;
    font-weight: 500;
    transition: all 0.2s ease;
  }

  .nav-link:hover {
    background: var(--background);
    transform: translateX(2px);
  }

  .nav-link.active {
    background: linear-gradient(
      135deg,
      var(--primary) 0%,
      var(--primary-dark) 100%
    );
    color: white;
    box-shadow: var(--shadow);
  }

  .nav-icon {
    font-size: 1.25rem;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
  }

  .user-profile {
    margin-top: auto;
    padding: 1rem;
    border-top: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .user-avatar {
    width: 40px;
    height: 40px;
    background: linear-gradient(
      135deg,
      var(--primary) 0%,
      var(--secondary) 100%
    );
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: 1.125rem;
    box-shadow: var(--shadow);
  }

  .user-info {
    flex: 1;
  }

  .user-name {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text);
    margin: 0;
  }

  .user-role {
    font-size: 0.75rem;
    color: var(--text-muted);
    margin: 0.125rem 0 0 0;
  }

  /* Welcome Banner */
  .welcome-banner {
    background: linear-gradient(
      135deg,
      var(--primary) 0%,
      var(--secondary) 100%
    );
    color: white;
    padding: 2rem;
    border-radius: var(--radius-lg);
    margin-bottom: 2rem;
    box-shadow: var(--shadow-lg);
    position: relative;
    overflow: hidden;
  }

  .welcome-content {
    position: relative;
    z-index: 1;
  }

  .welcome-title {
    font-size: 1.875rem;
    font-weight: 700;
    margin: 0 0 0.5rem 0;
  }

  .welcome-subtitle {
    font-size: 1rem;
    opacity: 0.95;
    margin: 0;
    font-weight: 400;
  }

  .welcome-decoration {
    position: absolute;
    top: -50px;
    right: -50px;
    opacity: 0.1;
  }

  .decoration-circle {
    width: 200px;
    height: 200px;
    background: white;
    border-radius: 50%;
    position: absolute;
  }

  .decoration-circle:nth-child(2) {
    width: 150px;
    height: 150px;
    top: 80px;
    right: 60px;
  }

  /* Card Enhancements */
  .card {
    background: var(--surface);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    box-shadow: var(--shadow);
    border: 1px solid var(--border);
    margin-bottom: 1.5rem;
    transition: all 0.3s ease;
  }

  .card:hover {
    box-shadow: var(--shadow-lg);
    transform: translateY(-2px);
  }

  .card-header {
    margin-bottom: 1.5rem;
  }

  .card-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text);
    margin: 0;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .card-icon {
    font-size: 1.5rem;
    display: flex;
    align-items: center;
  }

  /* Form Enhancements */
  .form-group {
    margin-bottom: 1.5rem;
  }

  .form-label {
    display: block;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 0.75rem;
  }

  .file-input-wrapper {
    position: relative;
  }

  .file-input {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
  }

  .file-input-label {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    border: 2px dashed var(--border);
    border-radius: var(--radius);
    background: var(--background);
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .file-input-label:hover {
    border-color: var(--primary);
    background: linear-gradient(
      135deg,
      rgba(99, 102, 241, 0.05) 0%,
      rgba(139, 92, 246, 0.05) 100%
    );
    transform: scale(1.01);
  }

  .file-input-icon {
    font-size: 2.5rem;
    margin-bottom: 0.75rem;
  }

  .file-input-text {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 0.25rem;
  }

  .file-input-hint {
    font-size: 0.75rem;
    color: var(--text-muted);
  }

  /* File Preview Card */
  .file-preview-card {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 1rem;
    background: var(--background);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    margin-bottom: 1rem;
  }

  .file-preview-card.hidden {
    display: none;
  }

  .file-preview-icon {
    font-size: 2rem;
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border-radius: 8px;
    box-shadow: var(--shadow-sm);
  }

  .file-preview-info {
    flex: 1;
  }

  .file-preview-name {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text);
    margin: 0 0 0.25rem 0;
  }

  .file-preview-size {
    font-size: 0.75rem;
    color: var(--text-muted);
    margin: 0;
  }

  .file-preview-remove {
    background: none;
    border: none;
    color: var(--danger);
    cursor: pointer;
    font-size: 1.25rem;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.2s ease;
  }

  .file-preview-remove:hover {
    background: rgba(239, 68, 68, 0.1);
  }

  /* Button Enhancements */
  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 12px 24px;
    border: none;
    border-radius: var(--radius);
    font-weight: 600;
    font-size: 0.875rem;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
  }

  .btn-primary {
    background: linear-gradient(
      135deg,
      var(--primary) 0%,
      var(--primary-dark) 100%
    );
    color: white;
    box-shadow: var(--shadow);
  }

  .btn-primary:hover {
    box-shadow: var(--shadow-lg);
    transform: translateY(-2px);
  }

  .btn-arrow {
    transition: transform 0.3s ease;
  }

  .btn:hover .btn-arrow {
    transform: translateX(4px);
  }

  .btn-upload,
  .btn-send {
    width: 100%;
  }

  /* Uploaded Files Section */
  .uploaded-files-section {
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--border);
  }

  .section-label {
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin: 0 0 1rem 0;
  }

  .uploaded-files-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .uploaded-file-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: var(--background);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    transition: all 0.2s ease;
  }

  .uploaded-file-item:hover {
    background: white;
    box-shadow: var(--shadow-sm);
    transform: translateX(4px);
  }

  .uploaded-file-icon {
    font-size: 1.5rem;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border-radius: 8px;
    box-shadow: var(--shadow-sm);
  }

  .uploaded-file-info {
    flex: 1;
  }

  .uploaded-file-name {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text);
    margin: 0 0 0.25rem 0;
  }

  .uploaded-file-meta {
    font-size: 0.75rem;
    color: var(--text-muted);
    margin: 0;
  }

  .uploaded-file-status {
    width: 24px;
    height: 24px;
    background: var(--success);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
    font-weight: 700;
  }

  /* Question Section */
  .question-input-wrapper {
    margin-bottom: 1rem;
  }

  .question-textarea {
    width: 100%;
    min-height: 120px;
    padding: 1rem;
    border: 2px solid var(--border);
    border-radius: var(--radius);
    font-size: 0.875rem;
    font-family: inherit;
    resize: vertical;
    transition: all 0.3s ease;
  }

  .question-textarea:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
  }

  .question-actions {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .quick-questions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }

  .quick-question-btn {
    padding: 8px 16px;
    background: var(--background);
    border: 1px solid var(--border);
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--text);
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .quick-question-btn:hover {
    background: white;
    border-color: var(--primary);
    color: var(--primary);
    box-shadow: var(--shadow-sm);
  }

  /* Chat Enhancements */
  .chat-container {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    max-height: 600px;
    overflow-y: auto;
    padding: 0.5rem;
  }

  .message {
    display: flex;
    gap: 12px;
    align-items: flex-start;
  }

  .message-user {
    flex-direction: row-reverse;
  }

  .message-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 0.875rem;
    flex-shrink: 0;
    box-shadow: var(--shadow);
  }

  .message-user .message-avatar {
    background: linear-gradient(
      135deg,
      var(--primary) 0%,
      var(--secondary) 100%
    );
    color: white;
  }

  .message-bot .message-avatar {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    color: white;
  }

  .message-bubble {
    max-width: 70%;
    padding: 12px 16px;
    border-radius: var(--radius);
    box-shadow: var(--shadow-sm);
  }

  .message-user .message-bubble {
    background: linear-gradient(
      135deg,
      var(--primary) 0%,
      var(--primary-dark) 100%
    );
    color: white;
    border-bottom-right-radius: 4px;
  }

  .message-bot .message-bubble {
    background: var(--background);
    color: var(--text);
    border: 1px solid var(--border);
    border-bottom-left-radius: 4px;
  }

  .message-text {
    font-size: 0.875rem;
    line-height: 1.5;
    margin: 0;
  }

  .message-time {
    font-size: 0.6875rem;
    margin: 0.5rem 0 0 0;
    opacity: 0.7;
  }

  .message-user .message-time {
    text-align: right;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .welcome-title {
      font-size: 1.5rem;
    }

    .question-actions {
      flex-direction: column;
      align-items: stretch;
    }

    .btn-send {
      width: 100%;
    }

    .message-bubble {
      max-width: 85%;
    }
  }

  /* Utility Classes */
  .mb-1 {
    margin-bottom: 0.5rem;
  }
  .mb-2 {
    margin-bottom: 1rem;
  }
  .mb-3 {
    margin-bottom: 1.5rem;
  }
  .mt-2 {
    margin-top: 1rem;
  }
  .mt-3 {
    margin-top: 1.5rem;
  }
  .hidden {
    display: none;
  }
  .text-xs {
    font-size: 0.75rem;
  }
  .text-sm {
    font-size: 0.875rem;
  }
  .text-muted {
    color: var(--text-muted);
  }
</style>
{% endblock %} {% block scripts %}
<script>
  function previewFile(input) {
    const file = input.files[0];
    if (file) {
      document.getElementById("filePreview").classList.remove("hidden");
      document.getElementById("fileName").textContent = file.name;
      document.getElementById("fileSize").textContent = formatBytes(file.size);
    }
  }

  function clearFile() {
    document.getElementById("uploadForm").reset();
    document.getElementById("filePreview").classList.add("hidden");
  }

  function formatBytes(bytes) {
    if (bytes === 0) return "0 Bytes";
    const k = 1024;
    const sizes = ["Bytes", "KB", "MB", "GB"];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + " " + sizes[i];
  }

  function quickQuestion(text) {
    document.querySelector('textarea[name="question"]').value = text;
    document.querySelector('textarea[name="question"]').focus();
  }

  // Add drag and drop functionality
  const fileInputLabel = document.querySelector(".file-input-label");
  const fileInput = document.getElementById("fileInput");

  if (fileInputLabel && fileInput) {
    ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
      fileInputLabel.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }

    ["dragenter", "dragover"].forEach((eventName) => {
      fileInputLabel.addEventListener(eventName, highlight, false);
    });

    ["dragleave", "drop"].forEach((eventName) => {
      fileInputLabel.addEventListener(eventName, unhighlight, false);
    });

    function highlight(e) {
      fileInputLabel.style.borderColor = "var(--primary)";
      fileInputLabel.style.background =
        "linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%)";
    }

    function unhighlight(e) {
      fileInputLabel.style.borderColor = "";
      fileInputLabel.style.background = "";
    }

    fileInputLabel.addEventListener("drop", handleDrop, false);

    function handleDrop(e) {
      const dt = e.dataTransfer;
      const files = dt.files;
      fileInput.files = files;
      previewFile(fileInput);
    }
  }
</script>
{% endblock %}
